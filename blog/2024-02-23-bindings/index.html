<!DOCTYPE html><meta charset="utf-8"><meta content="width=device-width,initial-scale=1"name="viewport"><link href="/css/main.css"rel="stylesheet"><link href="/blog/feed.xml"rel="alternate"title="RSS Feed"type="application/atom+xml"><title>jank development update - Dynamic bindings and more!</title><meta content="jank development update - Dynamic bindings and more!"property="og:title"><meta content="jank now support dynamic vars, meta hints, reader macros, and exceptions!"property="og:description"><meta content="https://jank-lang.org/img/logo-text-dark.png"property="og:image"><link href="/img/favicon/apple-touch-icon.png"rel="apple-touch-icon"sizes="180x180"><link href="/img/favicon/32.png"rel="icon"sizes="32x32"type="image/png"><link href="/img/favicon/16.png"rel="icon"sizes="16x16"type="image/png"><link href="/img/favicon/site.webmanifest"rel="manifest"><style>.gg-bulb{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:16px;height:16px;border:2px solid;border-bottom-color:transparent;border-radius:100px}.gg-bulb::after,.gg-bulb::before{content:"";display:block;box-sizing:border-box;position:absolute}.gg-bulb::before{border-top:0;border-bottom-left-radius:18px;border-bottom-right-radius:18px;top:10px;border-bottom:2px solid transparent;box-shadow:0 5px 0 -2px,inset 2px 0 0 0,inset -2px 0 0 0,inset 0 -4px 0 -2px;width:8px;height:8px;left:2px}.gg-bulb::after{width:12px;height:2px;border-left:3px solid;border-right:3px solid;border-radius:2px;bottom:0;left:0}.gg-check-o{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:22px;height:22px;border:2px solid;border-radius:100px}.gg-check-o::after{content:"";display:block;box-sizing:border-box;position:absolute;left:3px;top:-1px;width:6px;height:10px;border-color:currentColor;border-width:0 2px 2px 0;border-style:solid;transform-origin:bottom left;transform:rotate(45deg)}.gg-comment{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:20px;height:16px;border:2px solid;border-bottom:0;box-shadow:-6px 8px 0 -6px,6px 8px 0 -6px}.gg-comment::after,.gg-comment::before{content:"";display:block;box-sizing:border-box;position:absolute;width:8px}.gg-comment::before{border:2px solid;border-top-color:transparent;border-bottom-left-radius:20px;right:4px;bottom:-6px;height:6px}.gg-comment::after{height:2px;background:currentColor;box-shadow:0 4px 0 0;left:4px;top:4px}.gg-git-fork{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:2px;height:14px;background:currentColor}.gg-git-fork::after,.gg-git-fork::before{content:"";display:block;box-sizing:border-box;position:absolute}.gg-git-fork::before{border-right:2px solid;border-bottom:2px solid;border-bottom-right-radius:4px;bottom:4px;width:8px;height:6px;left:0}.gg-git-fork::after{width:4px;height:4px;background:currentColor;box-shadow:0 12px 0 0,6px 2px 0 0;border-radius:100%;left:-1px;top:-1px}.gg-heart,.gg-heart::after{border:2px solid;border-top-left-radius:100px;border-top-right-radius:100px;width:10px;height:8px;border-bottom:0}.gg-heart{box-sizing:border-box;position:relative;transform:translate(calc(-10px / 2 * var(--ggs,1)),calc(-6px / 2 * var(--ggs,1))) rotate(-45deg) scale(var(--ggs,1));display:block}.gg-heart::after,.gg-heart::before{content:"";display:block;box-sizing:border-box;position:absolute}.gg-heart::after{right:-9px;transform:rotate(90deg);top:5px}.gg-heart::before{width:11px;height:11px;border-left:2px solid;border-bottom:2px solid;left:-2px;top:3px}.gg-home{background:linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 0 bottom/4px 2px,linear-gradient(to left,currentColor 5px,transparent 0) no-repeat right bottom/4px 2px;box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:18px;height:14px;border:2px solid;border-top:0;border-bottom:0;border-top-right-radius:3px;border-top-left-radius:3px;border-bottom-right-radius:0;border-bottom-left-radius:0;margin-bottom:-2px}.gg-home::after,.gg-home::before{content:"";display:block;box-sizing:border-box;position:absolute}.gg-home::before{border-top:2px solid;border-left:2px solid;border-top-left-radius:4px;transform:rotate(45deg);top:-5px;border-radius:3px;width:14px;height:14px;left:0}.gg-home::after{width:8px;height:10px;border:2px solid;border-radius:100px;border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom:0;left:3px;bottom:0}.gg-info{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:20px;height:20px;border:2px solid;border-radius:40px}.gg-info::after,.gg-info::before{content:"";display:block;box-sizing:border-box;position:absolute;border-radius:3px;width:2px;background:currentColor;left:7px}.gg-info::after{bottom:2px;height:8px}.gg-info::before{height:2px;top:2px}.gg-link{box-sizing:border-box;position:relative;display:block;transform:rotate(-45deg) scale(var(--ggs,1));width:8px;height:2px;background:currentColor;border-radius:4px}.gg-link::after,.gg-link::before{content:"";display:block;box-sizing:border-box;position:absolute;border-radius:3px;width:8px;height:10px;border:2px solid;top:-4px}.gg-link::before{border-right:0;border-top-left-radius:40px;border-bottom-left-radius:40px;left:-6px}.gg-link::after{border-left:0;border-top-right-radius:40px;border-bottom-right-radius:40px;right:-6px}.gg-list{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:22px;height:20px;border:2px solid;border-radius:3px}.gg-list::after,.gg-list::before{content:"";display:block;box-sizing:border-box;position:absolute;width:2px;height:2px;background:currentColor;top:3px;left:3px;box-shadow:0 4px 0,0 8px 0}.gg-list::after{border-radius:3px;width:8px;left:7px}.gg-math-minus{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:16px;height:2px;background:currentColor;border-radius:10px}.gg-slack{position:relative;box-sizing:border-box;transform:scale(var(--ggs,1));display:block;width:20px;height:20px;background:linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 7px 2px/2px 2px,linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 15px 7px/2px 2px,linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 2px 10px/2px 2px,linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 10px 15px/2px 2px,linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 10px 2px/4px 5px,linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 5px 12px/4px 5px}.gg-slack::after,.gg-slack::before{background:currentColor;content:"";position:absolute;box-sizing:border-box;display:block;height:4px;border-radius:22px}.gg-slack::before{width:9px;top:5px;box-shadow:10px 5px 0}.gg-slack::after{width:4px;left:5px;box-shadow:-5px 10px 0,0 10px 0,0 15px 0,5px 15px 0,5px 5px 0,5px 0 0,10px 5px 0}.gg-sync{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));border-radius:40px;border:2px solid;margin:1px;border-left-color:transparent;border-right-color:transparent;width:18px;height:18px}.gg-sync::after,.gg-sync::before{content:"";display:block;box-sizing:border-box;position:absolute;width:0;height:0;border-top:4px solid transparent;border-bottom:4px solid transparent;transform:rotate(-45deg)}.gg-sync::before{border-left:6px solid;bottom:-1px;right:-3px}.gg-sync::after{border-right:6px solid;top:-1px;left:-3px}.gg-twitter{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:20px;height:20px}.gg-twitter::after,.gg-twitter::before{content:"";display:block;position:absolute;box-sizing:border-box;left:4px}.gg-twitter::before{width:9px;height:14px;border-left:4px solid;border-bottom:4px solid;border-bottom-left-radius:6px;background:linear-gradient(to left,currentColor 12px,transparent 0) no-repeat center 2px/10px 4px;top:4px}.gg-twitter::after{width:4px;height:4px;background:currentColor;border-radius:20px;top:2px;box-shadow:7px 4px 0,7px 12px 0}</style><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),(()=>{var a="//matomo.jeaye.com/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","1"]);var e=(p=document).createElement("script"),p=p.getElementsByTagName("script")[0];e.async=!0,e.src=a+"matomo.js",p.parentNode.insertBefore(e,p)})()</script><div><div><nav class="navbar is-primary"><div class="container"><div class="navbar-brand"><a class="navbar-item title has-text-white"href="/blog"style="font-family:Comfortaa"><img src="/img/logo-transparent.png"style="margin-right:15px">jank blog</a></div><div class="navbar-menu is-active"><div class="navbar-end has-text-weight-semibold"><a class="navbar-item has-text-white"href="/"><span class="icon mr-1"><i class="gg-home"></i></span><strong>Home</strong></a><a class="navbar-item has-text-white"href="/blog"><span class="icon mr-1"><i class="gg-comment"></i></span><strong>Blog</strong></a><a class="navbar-item has-text-white"href="https://github.com/sponsors/jeaye"><span class="icon mr-1"style="color:#c96198"><i class="gg-heart"></i></span><strong>Sponsor</strong></a><a class="navbar-item has-text-white"href="https://github.com/jank-lang/jank"><span class="icon mr-1"><i class="gg-git-fork"></i></span><strong>Github</strong></a><a class="navbar-item has-text-white"href="https://clojurians.slack.com/archives/C03SRH97FDK"><span class="icon mr-1"><i class="gg-slack"></i></span>Slack</a><a class="navbar-item has-text-white"href="https://twitter.com/jeayewilkerson"><span class="icon mr-1"><i class="gg-twitter"></i></span>Twitter</a></div></div></div></nav></div><section class="section"><div class="container blog-container"><span class="is-size-1">jank development update - Dynamic bindings and more!</span><div class="is-size-6 has-text-weight-light">Feb 23, 2024 Â· <a class="has-text-weight-normal"href="https://github.com/jeaye">Jeaye Wilkerson</a></div><hr><div class="content"><p>For the past couple of months, I have been focused on tackling dynamic var bindings and meta hints, which grew into much, much more. Along the way, I've learned some neat things and have positioned jank to be ready for a lot more outside contributions. Grab a seat and I'll explain it all! Much love to <a href="https://www.clojuriststogether.org/">Clojurists Together</a>, who have sponsored some of my work this quarter.<h2>Vars and roots</h2><p>I estimated that dynamic bindings would take me a while to implement, mainly because, even after several years of using Clojure, I still didn't know how they worked. It's because of this that I'll now explain it to all of you. We can break it down into two parts:<ol><li>Var roots<li>Var bindings (overrides)</ol><p>So, firstly, each var is a container for an object (though vars may start out unbound, they still hold a special unbound object regardless). That object is known as the var's root. When you define a var with <code>def</code> or <code>defn</code>, you're generally providing its root.<pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#88846f">; person is a var and its root is &quot;sally&quot;</span></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">def</span><span style="color:#f8f8f2"> person </span><span style="color:#e6db74">&quot;sally&quot;</span><span style="color:#fd971f">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; add is a var and its root is an instance of the fn</span></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">defn</span><span style="color:#f8f8f2"> add </span><span style="color:#fd971f">[</span><span style="color:#f8f8f2">x y</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#a6e22e">+</span><span style="color:#f8f8f2"> x y</span><span style="color:#fd971f">))</span></span></code></pre><p>When we refer to a var by its name, we're implicitly dereferencing that var in order to get its root.<pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#88846f">; You write this.</span></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#a6e22e">println</span><span style="color:#f8f8f2"> person</span><span style="color:#fd971f">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; Implicitly, it does something more like this.</span></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#a6e22e">println</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">deref</span><span style="color:#f8f8f2"> #'person</span><span style="color:#fd971f">))</span></span></code></pre><p>When we use a REPL client to re-evaluate a file, which evaluates the <code>def</code> and <code>defn</code> forms again, we end up changing the root of those vars. The old root is gone entirely. There's another way we can alter the root of a var, which is using the <code>alter-var-root</code> function. This is very similar to just redefining it. The old root is gone.<p>However, for some vars, we want to change the root for only a short period of time, after which we'll want the old value replaced. We can do this with <code>with-redefs</code>.<pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#fd971f">(</span><span style="color:#a6e22e">println</span><span style="color:#f8f8f2"> person</span><span style="color:#fd971f">)</span><span style="color:#88846f"> ; =&gt; sally</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; Within the scope of this form, we redefine our var.</span></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#a6e22e">with-redefs</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">person </span><span style="color:#e6db74">&quot;joe&quot;</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#a6e22e">println</span><span style="color:#f8f8f2"> person</span><span style="color:#fd971f">))</span><span style="color:#88846f"> ; =&gt; joe</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; Now it's back to being sally.</span></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#a6e22e">println</span><span style="color:#f8f8f2"> person</span><span style="color:#fd971f">)</span><span style="color:#88846f"> ; =&gt; sally</span></span></code></pre><p>An important thing to note is that changing a var root affects every running thread of the program. The var root is global and synchronized. This is great, for some things, but sometimes we only want to change a var on our current thread. For example, in Clojure there is a var called <code>*out*</code> which holds a <code>java.io.Writer</code> object. Any core functions which write to stdout will write to that object. Let's say we have a particular bit of code where we want to write to a file.<pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#88846f">; Open a file, redefine *out* to point to the writer, and then write to *out*.</span></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#a6e22e">with-open</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">log </span><span style="color:#fd971f">(</span><span style="color:#a6e22e">clojure.java.io/writer</span><span style="color:#e6db74"> &quot;system.log&quot;</span><span style="color:#819aff"> :append</span><span style="color:#ae81ff"> true</span><span style="color:#fd971f">)]</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#a6e22e">with-redefs</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">*out* log</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#fd971f">    (</span><span style="color:#a6e22e">println</span><span style="color:#e6db74"> &quot;this should go into a file&quot;</span><span style="color:#fd971f">)))</span></span></code></pre><p>This works! However, if you have any other threads which are also writing to <code>*out*</code>, you may find that what they write ends up going into your log file, too! This is because every thread is affected by the changing of a var's root. So how would we avoid this problem? Dynamic bindings!<h2>Dynamic bindings</h2><p>With dynamic bindings, we can supply an &quot;override&quot; for a var, without changing its root. Even better, that override is tied only to our current thread. The way that this works is that, separate from the var itself, Clojure keeps track of a map of overrides. The map is from var to value. Something like this:<pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#fd971f">{</span><span style="color:#f8f8f2">#'*out* log</span><span style="color:#fd971f">}</span></span></code></pre><p>There's one extra trick here, though. Rather than just a single map of overrides, we have a stack. Each time a var is overridden, a new map is pushed onto the stack. We always pull from the top of the stack to the get latest value for a var. Let's take a look at an example.<pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">def</span><span style="color:#f8f8f2"> ^:dynamic *foo* </span><span style="color:#ae81ff">42</span><span style="color:#fd971f">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">binding</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">*foo* </span><span style="color:#ae81ff">0</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#fb4934;font-weight:700">binding</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">*foo* </span><span style="color:#ae81ff">100</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#fd971f">    (</span><span style="color:#a6e22e">println</span><span style="color:#f8f8f2"> *foo*</span><span style="color:#fd971f">))</span><span style="color:#88846f"> ; =&gt; 100</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#a6e22e">println</span><span style="color:#f8f8f2"> *foo*</span><span style="color:#fd971f">))</span><span style="color:#88846f"> ; =&gt; 0</span></span></code></pre><p>Here, we have a var which has a root of 42. We note this var as dynamic, which means we can provide these overrides, known as bindings. There's a <code>binding</code> macro which helps us do this, but all it does it push the new override and then pop at the end. Our stack (which is a linked list) of overrides might look something like this:<pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#88846f">; Initially, no overrides, let's say. An empty stack.</span></span>
<span class="line"><span style="color:#fd971f">'()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; When we bind *foo* to 0, we add an override.</span></span>
<span class="line"><span style="color:#fd971f">'({</span><span style="color:#f8f8f2">#'*foo* </span><span style="color:#ae81ff">0</span><span style="color:#fd971f">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; When we bind *foo* to 100, we add an override.</span></span>
<span class="line"><span style="color:#fd971f">'({</span><span style="color:#f8f8f2">#'*foo* </span><span style="color:#ae81ff">100</span><span style="color:#fd971f">}</span><span style="color:#fd971f"> {</span><span style="color:#f8f8f2">#'*foo* </span><span style="color:#ae81ff">0</span><span style="color:#fd971f">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; At the end of each binding form, we pop from the top of the stack.</span></span></code></pre><p>With this stack of overrides, we just need to update the <code>deref</code> implementation for vars to not just return the root. Instead, they check if the var has any overrides and then returns the latest override, falling back on the root if there is none. In jank's C++ code, that looks like this:<pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#a6e22e">object_ptr</span><span style="color:#a6e22e"> var</span><span style="color:#f8f8f2">::</span><span style="color:#a6e22e">deref</span><span style="color:#fd971f">()</span><span style="color:#f8f8f2"> const</span></span>
<span class="line"><span style="color:#fd971f">{</span></span>
<span class="line"><span style="color:#66d9ef;font-style:italic">  auto</span><span style="color:#f8f8f2"> const </span><span style="color:#a6e22e">binding</span><span style="color:#fd971f">(</span><span style="color:#a6e22e">get_thread_binding</span><span style="color:#fd971f">())</span><span style="color:#f8f8f2">;</span></span>
<span class="line"><span style="color:#fb4934;font-weight:700">  if</span><span style="color:#fd971f">(</span><span style="color:#f8f8f2">binding</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#fd971f">  {</span><span style="color:#fb4934;font-weight:700"> return</span><span style="color:#f8f8f2"> binding-&gt;value; </span><span style="color:#fd971f">}</span></span>
<span class="line"><span style="color:#fb4934;font-weight:700">  return</span><span style="color:#fb4934;font-weight:700"> *</span><span style="color:#f8f8f2">root.</span><span style="color:#a6e22e">rlock</span><span style="color:#fd971f">()</span><span style="color:#f8f8f2">;</span></span>
<span class="line"><span style="color:#fd971f">}</span></span></code></pre><h2>Binding conveyance</h2><p>There's one other neat thing about dynamic bindings which can't go unmentioned. When you make a new thread in Clojure, the current var overrides you have get copied over to the new thread. The same applies to async blocks in core.async. This allows you to set up some var state and push it to another thread without needing to rebuild everything. With core.async, each time your task becomes unparked, bindings are re-established to what they were before. This ends up being super convenient and can feel magical.<p>Thanks to Tim Baldridge for <a href="https://cognitect.com/blog/2016/9/15/works-on-my-machine-understanding-var-bindings-and-roots">his post</a> on this stuff, which helped put it more into terms I could understand. My goal here has been to reiterate and elucidate.<h2>Status report</h2><p>Ok, so all of this is implemented in jank now. I could've just said that from the beginning, I know, but I get paid by the character still, I swear. jank doesn't have <code>future</code> yet, but everything is in place for binding conveyance. To go hand in hand with this, I tackled meta hints next, allowing us to do things like <code>^:dynamic</code> on a var.<h2>Meta hints</h2><p>This one doesn't get a big explanation. jank now supports hints in the form of <code>^:keyword</code>, as well as <code>^{:keyword true}</code>. Multiple hints can be specified, they can be nested, etc. Not many parts of jank are using these hints yet, since I didn't go through all existing code to update usages, but we can do that iteratively. See? I can be brief.<h2>What else?</h2><p>Well, my quarter was booked for the following tasks:<ul><li>ð¹ Dynamic vars<li>ð¹ Meta hints<li>â Syntax quoting<li>â Normalized interpolation syntax</ul><p>The first two are done and the latter two remain, to be done in the next month. But is that all I did in two months? Just dynamic vars and meta hints? Nah.<h2>Support for exceptions</h2><p>I've added support for the special <code>throw</code> form, as well as for <code>try/catch/finally</code>. Previously, I was using inline C++ to throw exceptions, but the work on the dynamic vars gave me a good excuse to get proper exception support in there. I needed to ensure bindings were gracefully handled in exceptional scenarios!<p>My plan is to do a compiler deep dive, next post, going into how exceptions were implemented in jank. Stay tuned for that.<h2>Escaped string literals</h2><p>jank previously didn't properly support strings like <code>&quot;foo \&quot;bar\&quot; spam&quot;</code>, since they require mutation in order to unescape them. This is an interesting edge case, because all of the other tokens within jank's lexer work based on memory mapped string views. String views allow jank's lexer to run without any dynamic allocations at all. However, for escaped strings, we need to allocate a string, since we need to mutate it when unescaping. It's straight-forward, but just something I hadn't tackled yet.<h2>Reader macros</h2><p>Since I was improving the reader to support meta hints, I figured I'd add reader macro support. In jank, you can now use <code>#_</code> to comment out forms. Also, you can use <code>#{}</code> to create sets. Finally, you can use <code>#?(:jank foo)</code> and <code>#?@(:jank [])</code> to conditionally read in jank code. The <code>:default</code> option is supported, too. Support for shorthand functions, regex values, and var quotes will be coming soon.<h2>New core functions and macros</h2><p>While implementing the above features, I also added support for the following vars in <code>clojure.core</code>:<ul><li><code>assert</code><li><code>when-not</code><li><code>comment</code><li><code>zipmap</code><li><code>binding</code><li><code>with-redefs</code><li><code>drop</code> (not lazy)<li><code>take-nth</code> (not lazy)</ul><p>Since jank doesn't have lazy sequences yet, some of these functions are a little hacky. Lazy sequences come next quarter, though, as well as <code>loop</code> support!<h2>Community involvement</h2><p>But wait, there's more! jank received its first non-trivial code contributions this quarter, from a helpful man named <a href="https://github.com/Samy-33">Saket Patel</a>. He's working on a <a href="https://github.com/Samy-33/lein-jank">jank plugin</a> for leiningen and it's currently in a state where you can set up a multi-file jank project and use <code>lein jank run</code> to make magic happen. ð He's also submitted some C++ improvements to aid in that quest and to help jank compile on Apple M1 hardware. I'll have a more detailed demonstration of this in my next development update.<p>On top of that, in order to get him set up for contributing, I've done the following:<ul><li>Added a <a href="https://github.com/jank-lang/jank/blob/main/CODE_OF_CONDUCT.md">Code of Conduct</a><li>Added a <a href="https://cla-assistant.io/jank-lang/jank">CLA</a>, which is managed by a bot that will prompt you to sign upon submitting a PR with a large enough<li>Added automated code formatting and re-formatted the whole codebase, using clang-format. I don't like the look of it, but at least it's consistent</ul><h2>Would you like to join in?</h2><ol><li>Join the community on <a href="https://clojurians.slack.com/archives/C03SRH97FDK">Slack</a><li>Join the design discussions or pick up a ticket on <a href="https://github.com/jank-lang/jank">GitHub</a><li>Considering becoming a <a href="https://github.com/sponsors/jeaye">Sponsor</a> <span class="icon mr-1"style="color:#c96198"><i class="gg-heart"></i></span><li><strong>Hire me full-time to work on jank!</strong></ol></div></div></section></div><footer class="footer"><div class="container"><div class="columns has-text-centered"></div><div class="container has-text-centered"><div class="content is-small"><p>Â© 2025 Jeaye Wilkerson | All rights reserved.</div></div></div></footer><noscript><p><img src="//matomo.jeaye.com/matomo.php?idsite=1&amp;rec=1"style="border:0"alt=""></p></noscript><script>for(var coll=document.getElementsByClassName("collapsible"),i=0;i<coll.length;i++)coll[i].addEventListener("click",function(){this.classList.toggle("active");var l=this.nextElementSibling;"block"===l.style.display?l.style.display="none":l.style.display="block"})</script>