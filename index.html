<!DOCTYPE html><meta charset="utf-8"><meta content="width=device-width,initial-scale=1"name="viewport"><link href="/css/main.css"rel="stylesheet"><link href="/blog/feed.xml"rel="alternate"title="RSS Feed"type="application/atom+xml"><title>jank programming language - Clojure/LLVM/C++</title><meta content="jank programming language - Clojure/LLVM/C++"property="og:title"><meta content="jank is a Clojure dialect on LLVM with a native runtime and C++ interop."property="og:description"><meta content="https://jank-lang.org/img/logo-text-dark.png"property="og:image"><link href="/img/favicon/apple-touch-icon.png"rel="apple-touch-icon"sizes="180x180"><link href="/img/favicon/32.png"rel="icon"sizes="32x32"type="image/png"><link href="/img/favicon/16.png"rel="icon"sizes="16x16"type="image/png"><link href="/img/favicon/site.webmanifest"rel="manifest"><style>.gg-bulb{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:16px;height:16px;border:2px solid;border-bottom-color:transparent;border-radius:100px}.gg-bulb::after,.gg-bulb::before{content:"";display:block;box-sizing:border-box;position:absolute}.gg-bulb::before{border-top:0;border-bottom-left-radius:18px;border-bottom-right-radius:18px;top:10px;border-bottom:2px solid transparent;box-shadow:0 5px 0 -2px,inset 2px 0 0 0,inset -2px 0 0 0,inset 0 -4px 0 -2px;width:8px;height:8px;left:2px}.gg-bulb::after{width:12px;height:2px;border-left:3px solid;border-right:3px solid;border-radius:2px;bottom:0;left:0}.gg-check-o{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:22px;height:22px;border:2px solid;border-radius:100px}.gg-check-o::after{content:"";display:block;box-sizing:border-box;position:absolute;left:3px;top:-1px;width:6px;height:10px;border-color:currentColor;border-width:0 2px 2px 0;border-style:solid;transform-origin:bottom left;transform:rotate(45deg)}.gg-comment{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:20px;height:16px;border:2px solid;border-bottom:0;box-shadow:-6px 8px 0 -6px,6px 8px 0 -6px}.gg-comment::after,.gg-comment::before{content:"";display:block;box-sizing:border-box;position:absolute;width:8px}.gg-comment::before{border:2px solid;border-top-color:transparent;border-bottom-left-radius:20px;right:4px;bottom:-6px;height:6px}.gg-comment::after{height:2px;background:currentColor;box-shadow:0 4px 0 0;left:4px;top:4px}.gg-git-fork{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:2px;height:14px;background:currentColor}.gg-git-fork::after,.gg-git-fork::before{content:"";display:block;box-sizing:border-box;position:absolute}.gg-git-fork::before{border-right:2px solid;border-bottom:2px solid;border-bottom-right-radius:4px;bottom:4px;width:8px;height:6px;left:0}.gg-git-fork::after{width:4px;height:4px;background:currentColor;box-shadow:0 12px 0 0,6px 2px 0 0;border-radius:100%;left:-1px;top:-1px}.gg-heart,.gg-heart::after{border:2px solid;border-top-left-radius:100px;border-top-right-radius:100px;width:10px;height:8px;border-bottom:0}.gg-heart{box-sizing:border-box;position:relative;transform:translate(calc(-10px / 2 * var(--ggs,1)),calc(-6px / 2 * var(--ggs,1))) rotate(-45deg) scale(var(--ggs,1));display:block}.gg-heart::after,.gg-heart::before{content:"";display:block;box-sizing:border-box;position:absolute}.gg-heart::after{right:-9px;transform:rotate(90deg);top:5px}.gg-heart::before{width:11px;height:11px;border-left:2px solid;border-bottom:2px solid;left:-2px;top:3px}.gg-home{background:linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 0 bottom/4px 2px,linear-gradient(to left,currentColor 5px,transparent 0) no-repeat right bottom/4px 2px;box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:18px;height:14px;border:2px solid;border-top:0;border-bottom:0;border-top-right-radius:3px;border-top-left-radius:3px;border-bottom-right-radius:0;border-bottom-left-radius:0;margin-bottom:-2px}.gg-home::after,.gg-home::before{content:"";display:block;box-sizing:border-box;position:absolute}.gg-home::before{border-top:2px solid;border-left:2px solid;border-top-left-radius:4px;transform:rotate(45deg);top:-5px;border-radius:3px;width:14px;height:14px;left:0}.gg-home::after{width:8px;height:10px;border:2px solid;border-radius:100px;border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom:0;left:3px;bottom:0}.gg-info{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:20px;height:20px;border:2px solid;border-radius:40px}.gg-info::after,.gg-info::before{content:"";display:block;box-sizing:border-box;position:absolute;border-radius:3px;width:2px;background:currentColor;left:7px}.gg-info::after{bottom:2px;height:8px}.gg-info::before{height:2px;top:2px}.gg-link{box-sizing:border-box;position:relative;display:block;transform:rotate(-45deg) scale(var(--ggs,1));width:8px;height:2px;background:currentColor;border-radius:4px}.gg-link::after,.gg-link::before{content:"";display:block;box-sizing:border-box;position:absolute;border-radius:3px;width:8px;height:10px;border:2px solid;top:-4px}.gg-link::before{border-right:0;border-top-left-radius:40px;border-bottom-left-radius:40px;left:-6px}.gg-link::after{border-left:0;border-top-right-radius:40px;border-bottom-right-radius:40px;right:-6px}.gg-list{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:22px;height:20px;border:2px solid;border-radius:3px}.gg-list::after,.gg-list::before{content:"";display:block;box-sizing:border-box;position:absolute;width:2px;height:2px;background:currentColor;top:3px;left:3px;box-shadow:0 4px 0,0 8px 0}.gg-list::after{border-radius:3px;width:8px;left:7px}.gg-math-minus{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:16px;height:2px;background:currentColor;border-radius:10px}.gg-slack{position:relative;box-sizing:border-box;transform:scale(var(--ggs,1));display:block;width:20px;height:20px;background:linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 7px 2px/2px 2px,linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 15px 7px/2px 2px,linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 2px 10px/2px 2px,linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 10px 15px/2px 2px,linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 10px 2px/4px 5px,linear-gradient(to left,currentColor 5px,transparent 0) no-repeat 5px 12px/4px 5px}.gg-slack::after,.gg-slack::before{background:currentColor;content:"";position:absolute;box-sizing:border-box;display:block;height:4px;border-radius:22px}.gg-slack::before{width:9px;top:5px;box-shadow:10px 5px 0}.gg-slack::after{width:4px;left:5px;box-shadow:-5px 10px 0,0 10px 0,0 15px 0,5px 15px 0,5px 5px 0,5px 0 0,10px 5px 0}.gg-sync{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));border-radius:40px;border:2px solid;margin:1px;border-left-color:transparent;border-right-color:transparent;width:18px;height:18px}.gg-sync::after,.gg-sync::before{content:"";display:block;box-sizing:border-box;position:absolute;width:0;height:0;border-top:4px solid transparent;border-bottom:4px solid transparent;transform:rotate(-45deg)}.gg-sync::before{border-left:6px solid;bottom:-1px;right:-3px}.gg-sync::after{border-right:6px solid;top:-1px;left:-3px}.gg-twitter{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:20px;height:20px}.gg-twitter::after,.gg-twitter::before{content:"";display:block;position:absolute;box-sizing:border-box;left:4px}.gg-twitter::before{width:9px;height:14px;border-left:4px solid;border-bottom:4px solid;border-bottom-left-radius:6px;background:linear-gradient(to left,currentColor 12px,transparent 0) no-repeat center 2px/10px 4px;top:4px}.gg-twitter::after{width:4px;height:4px;background:currentColor;border-radius:20px;top:2px;box-shadow:7px 4px 0,7px 12px 0}</style><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),(()=>{var a="//matomo.jeaye.com/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","1"]);var e=(p=document).createElement("script"),p=p.getElementsByTagName("script")[0];e.async=!0,e.src=a+"matomo.js",p.parentNode.insertBefore(e,p)})()</script><div><div><nav class="navbar"><div class="container"><div class="navbar-brand"><a class="navbar-item title has-text-white"href="/"style="font-family:Comfortaa"><img src="/img/logo-transparent.png"style="margin-right:15px">jank</a></div><div class="navbar-menu is-active"><div class="navbar-end has-text-weight-semibold"><a class="navbar-item has-text-white"href="/"><span class="icon mr-1"><i class="gg-home"></i></span><strong>Home</strong></a><a class="navbar-item has-text-white"href="/blog"><span class="icon mr-1"><i class="gg-comment"></i></span><strong>Blog</strong></a><a class="navbar-item has-text-white"href="/progress"><span class="icon mr-1"><i class="gg-list"></i></span><strong>Progress</strong></a><a class="navbar-item has-text-white"href="https://github.com/jank-lang/jank"><span class="icon mr-1"><i class="gg-git-fork"></i></span><strong>Github</strong></a><a class="navbar-item has-text-white"href="https://clojurians.slack.com/archives/C03SRH97FDK"><span class="icon mr-1"><i class="gg-slack"></i></span>Slack</a><a class="navbar-item has-text-white"href="https://twitter.com/jeayewilkerson"><span class="icon mr-1"><i class="gg-twitter"></i></span>Twitter</a></div></div></div></nav></div><section class="hero"><div class="hero-body"><div class="container py-6"><div class="columns"><div class="column mt-6 is-offset-2 is-8"><p class="title">The jank programming language<p class="content is-size-5"><p class="content is-size-5"><p>jank is a <strong>general-purpose programming language</strong> which embraces the <strong>interactive, value-oriented</strong> nature of Clojure as well as the desire for <strong>native compilation and minimal runtimes</strong>. jank is <strong>strongly compatible with Clojure</strong> and considers itself a dialect of Clojure. Please note that jank is under heavy development; assume all features are planned or incomplete.<p><p class="content is-size-5"><p>Where jank differs from Clojure JVM is that its host is C++ on top of an <strong>LLVM-based JIT</strong>. This allows jank to offer the same benefits of <strong>REPL-based development</strong> while being able to <strong>seamlessly reach into the native world</strong> and compete seriously with JVM's performance.<p><p class="content is-size-5"><p>Still, jank is a Clojure dialect and thus includes its <strong>code-as-data philosophy and powerful macro system</strong>. jank remains a functional-first language which builds upon Clojure's rich set of <strong>persistent, immutable data structures</strong>. When mutability is needed, jank offers a software transaction memory and reactive agent system to ensure <strong>clean and correct multi-threaded designs</strong>.<p><p><div class="has-text-centered"><a class="button mt-6 ml-4"href="/progress"><span class="icon"><i class="gg-list"></i></span><strong>Current progress</strong></a><a class="button mt-6 ml-4"href="https://github.com/jank-lang/jank"><span class="icon"><i class="gg-git-fork"></i></span><strong>Github</strong></a><a class="button mt-6 ml-4"href="https://github.com/sponsors/jeaye"><span class="icon"style="color:#c96198"><i class="gg-heart"></i></span><strong>Sponsor</strong></a></div></div></div></div></div></section><section class="section"id="how-it-works"><div class="container has-text-centered"><div class="section-header mb-6"><h2 class="title">Wide spectrum dynamics</h2><h3 class="subtitle">Enjoy both REPL iteration with JIT compilation and static AOT compilation to native executables.</h3></div><div class="columns is-vcentered"><div class="column is-6"><span class="is-size-1">01</span><h3 class="title">Iterate like you would with Clojure</h3><p class="has-text-left">Iterate in the REPL and build your program from the ground up without leaving your editor.</div><div class="column is-6"><div class="content has-text-left"><pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">defn</span><span style="color:#f8f8f2"> -main </span><span style="color:#fd971f">[</span><span style="color:#f8f8f2">&amp; args</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#fb4934;font-weight:700">loop</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">game-state </span><span style="color:#fd971f">(</span><span style="color:#a6e22e">new-game!</span><span style="color:#fd971f">)]</span></span>
<span class="line"><span style="color:#fd971f">    (</span><span style="color:#fb4934;font-weight:700">when</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">done?</span><span style="color:#f8f8f2"> game-state</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#fd971f">      (</span><span style="color:#a6e22e">end-game!</span><span style="color:#f8f8f2"> game-state</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#fd971f">      (</span><span style="color:#fb4934;font-weight:700">recur</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">next-state</span><span style="color:#f8f8f2"> game-state</span><span style="color:#fd971f">)))))</span></span>
<span class="line"></span></code></pre></div></div></div><div class="columns is-vcentered"><div class="column is-6"><span class="is-size-1">02</span><h3 class="title">Reach into the native world</h3><p class="has-text-left">Seamlessly switch to inline C++ within your Clojure source, while still having access to your Clojure code using interpolation.</div><div class="column is-6"><div class="content has-text-left"><pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">defn</span><span style="color:#f8f8f2"> create-vertex-shader! </span><span style="color:#fd971f">[]</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#a6e22e">c++/glCreateShader</span><span style="color:#f8f8f2"> c++/GL_VERTEX_SHADER</span><span style="color:#fd971f">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">defn</span><span style="color:#f8f8f2"> set-shader-source! </span><span style="color:#fd971f">[</span><span style="color:#f8f8f2">shader source</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#fb4934;font-weight:700">let</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">shader </span><span style="color:#fd971f">(</span><span style="color:#a6e22e">int</span><span style="color:#f8f8f2"> shader</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#f8f8f2">        source </span><span style="color:#fd971f">(</span><span style="color:#a6e22e">str</span><span style="color:#f8f8f2"> source</span><span style="color:#fd971f">)]</span></span>
<span class="line"><span style="color:#fd971f">    (</span><span style="color:#a6e22e">c++/glShaderSource</span><span style="color:#f8f8f2"> shader </span><span style="color:#ae81ff">1</span><span style="color:#f8f8f2"> source c++/nullptr</span><span style="color:#fd971f">)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">defn</span><span style="color:#f8f8f2"> compile-shader! </span><span style="color:#fd971f">[</span><span style="color:#f8f8f2">shader</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#a6e22e">c++/glCompileShader</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">int</span><span style="color:#f8f8f2"> shader</span><span style="color:#fd971f">)))</span></span>
<span class="line"></span></code></pre></div></div></div><div class="columns is-vcentered"><div class="column is-6"><span class="is-size-1">03</span><h3 class="title">Compile to machine code</h3><p class="has-text-left">jank is built on an LLVM-based JIT. With AOT enabled, both statically and dynamically linked executables can be generated. The jank compiler itself has very speedy start times and low memory usage.</div><div class="column is-6"><div class="content has-text-left"><pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#a6e22e">$</span><span style="color:#e6db74"> time</span><span style="color:#e6db74"> taskset</span><span style="color:#ae81ff"> 0x1</span><span style="color:#e6db74"> clj</span><span style="color:#e6db74"> hello-world.clj</span></span>
<span class="line"><span style="color:#a6e22e">hello</span><span style="color:#e6db74"> world</span></span>
<span class="line"></span>
<span class="line"><span style="color:#a6e22e">real</span><span style="color:#e6db74"> 0m1.127s</span></span>
<span class="line"><span style="color:#a6e22e">user</span><span style="color:#e6db74"> 0m0.997s</span></span>
<span class="line"><span style="color:#a6e22e">sys</span><span style="color:#e6db74"> 0m0.111s</span></span>
<span class="line"></span></code></pre></div><div class="content has-text-left mt-4"><pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#a6e22e">$</span><span style="color:#e6db74"> time</span><span style="color:#e6db74"> taskset</span><span style="color:#ae81ff"> 0x1</span><span style="color:#e6db74"> jank</span><span style="color:#e6db74"> run</span><span style="color:#e6db74"> hello-world.clj</span></span>
<span class="line"><span style="color:#a6e22e">hello</span><span style="color:#e6db74"> world</span></span>
<span class="line"></span>
<span class="line"><span style="color:#a6e22e">real</span><span style="color:#e6db74"> 0m0.086s</span></span>
<span class="line"><span style="color:#a6e22e">user</span><span style="color:#e6db74"> 0m0.045s</span></span>
<span class="line"><span style="color:#a6e22e">sys</span><span style="color:#e6db74"> 0m0.040s</span></span>
<span class="line"></span></code></pre></div></div></div><div class="columns is-vcentered"><div class="column is-6"><span class="is-size-1">04</span><h3 class="title">World-class errors</h3><p class="has-text-left">jank stands in its own category among lisps for its error reporting quality. No bloated JVM stack traces, opaque errors, or lack of context.</div><div class="column is-6"><div class="code-image"><img src="/img/landing/step-4.png"style="padding:5px;border-radius:7px"width="100%"></div></div></div></div></section><section class="section has-background-primary has-text-white"id="features"><div class="container"><div class="section-header has-text-centered mb-6"><h2 class="title has-text-white">jank builds upon Clojure.</h2><h3 class="subtitle has-text-white">Keep your existing code; gain more confidence and more speed.</h3></div><div class="columns is-centered"><div class="column is-9"><div class="columns"><div class="column is-6"><div class="icon-text mb-4"><span class="icon"><i class="gg-bulb"></i></span><h3 class="title is-4 has-text-white">Strongly compatible with Clojure</h3></div><p><p>If it works with Clojure JVM and it works with ClojureScript, it should work with jank. There's a <code>:jank</code> reader conditional for when you need it.<p></div><div class="column is-6"><div class="icon-text mb-4"><span class="icon"><i class="gg-sync"></i></span><h3 class="title is-4 has-text-white">REPL and native JIT</h3></div><p>Use your favorite nREPL editor plugin. jank uses an LLVM-based JIT to compile machine code on the fly.</div></div><div class="columns"><div class="column is-6"><div class="icon-text mb-4"><span class="icon"><i class="gg-list"></i></span><h3 class="title is-4 has-text-white">Go native</h3></div><p>Reach into native libraries or interact directly with your native code base. Seamlessly write both C++ and Clojure in the same file.</div><div class="column is-6"><div class="icon-text mb-4"><span class="icon"><i class="gg-link"></i></span><h3 class="title is-4 has-text-white">Tooling friendly</h3></div><p>Leiningen, LSP, nREPL planned from the start. jank's compiler is also written with tooling in mind, so it can be used for lexing, parsing, and analysis.</div></div></div></div></div></section><section class="section"id="examples"><div class="container has-text-centered"><div class="section-header mb-6"><h2 class="title">jank examples</h2><h3 class="subtitle">All of the following examples are also valid Clojure code.</h3></div><div class="columns is-vcentered"><div class="column is-6"><h3 class="title">Generate a movie index</h3><p class="has-text-left"><p>jank has very powerful capabilities for representing and transforming arbitrary data. Here, idiomatic usages of <code>reduce</code>, <code>zipmap</code>, <code>repeat</code>, and <code>merge-with</code> help create an index from genre to movie id with ease. No lenses are required for working with nested data.<p></div><div class="column is-8"><div class="content has-text-left"><pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">def</span><span style="color:#f8f8f2"> movies </span><span style="color:#fd971f">{</span><span style="color:#819aff">:the-weather-man</span><span style="color:#fd971f"> {</span><span style="color:#819aff">:title</span><span style="color:#e6db74"> &quot;The Weather Man&quot;</span></span>
<span class="line"><span style="color:#819aff">                               :genres</span><span style="color:#fd971f"> [</span><span style="color:#819aff">:drama</span><span style="color:#819aff"> :comedy</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#819aff">                               :tomatometer</span><span style="color:#ae81ff"> 59</span><span style="color:#fd971f">}</span></span>
<span class="line"><span style="color:#819aff">             :nightcrawler</span><span style="color:#fd971f"> {</span><span style="color:#819aff">:title</span><span style="color:#e6db74"> &quot;Nightcrawler&quot;</span></span>
<span class="line"><span style="color:#819aff">                            :genres</span><span style="color:#fd971f"> [</span><span style="color:#819aff">:drama</span><span style="color:#819aff"> :crime</span><span style="color:#819aff"> :thriller</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#819aff">                            :tomatometer</span><span style="color:#ae81ff"> 95</span><span style="color:#fd971f">}</span></span>
<span class="line"><span style="color:#819aff">             :the-bourne-identity</span><span style="color:#fd971f"> {</span><span style="color:#819aff">:title</span><span style="color:#e6db74"> &quot;The Bourne Identity&quot;</span></span>
<span class="line"><span style="color:#819aff">                                   :genres</span><span style="color:#fd971f"> [</span><span style="color:#819aff">:action</span><span style="color:#819aff"> :thriller</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#819aff">                                   :tomatometer</span><span style="color:#ae81ff"> 84</span><span style="color:#fd971f">}})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">def</span><span style="color:#f8f8f2"> genre-&gt;movie </span><span style="color:#fd971f">(</span><span style="color:#a6e22e">reduce</span><span style="color:#fd971f"> (</span><span style="color:#fb4934;font-weight:700">fn</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">acc </span><span style="color:#fd971f">[</span><span style="color:#f8f8f2">id movie</span><span style="color:#fd971f">]]</span></span>
<span class="line"><span style="color:#fd971f">                            (</span><span style="color:#fb4934;font-weight:700">let</span><span style="color:#fd971f"> [{</span><span style="color:#819aff">:keys</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">genres</span><span style="color:#fd971f">]}</span><span style="color:#f8f8f2"> movie</span></span>
<span class="line"><span style="color:#f8f8f2">                                  genre-&gt;this-movie </span><span style="color:#fd971f">(</span><span style="color:#a6e22e">zipmap</span><span style="color:#f8f8f2"> genres </span><span style="color:#fd971f">(</span><span style="color:#a6e22e">repeat</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">id</span><span style="color:#fd971f">]))]</span></span>
<span class="line"><span style="color:#fd971f">                              (</span><span style="color:#a6e22e">merge-with</span><span style="color:#f8f8f2"> into acc genre-&gt;this-movie</span><span style="color:#fd971f">)))</span></span>
<span class="line"><span style="color:#fd971f">                          {}</span></span>
<span class="line"><span style="color:#f8f8f2">                          movies</span><span style="color:#fd971f">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; genre-&gt;movie is now a useful index.</span></span>
<span class="line"><span style="color:#88846f">; =&gt;</span></span>
<span class="line"><span style="color:#fd971f">{</span><span style="color:#819aff">:drama</span><span style="color:#fd971f"> [</span><span style="color:#819aff">:the-weather-man</span><span style="color:#819aff"> :nightcrawler</span><span style="color:#fd971f">]</span><span style="color:#f8f8f2">,</span></span>
<span class="line"><span style="color:#819aff"> :comedy</span><span style="color:#fd971f"> [</span><span style="color:#819aff">:the-weather-man</span><span style="color:#fd971f">]</span><span style="color:#f8f8f2">,</span></span>
<span class="line"><span style="color:#819aff"> :crime</span><span style="color:#fd971f"> [</span><span style="color:#819aff">:nightcrawler</span><span style="color:#fd971f">]</span><span style="color:#f8f8f2">,</span></span>
<span class="line"><span style="color:#819aff"> :thriller</span><span style="color:#fd971f"> [</span><span style="color:#819aff">:nightcrawler</span><span style="color:#819aff"> :the-bourne-identity</span><span style="color:#fd971f">]</span><span style="color:#f8f8f2">,</span></span>
<span class="line"><span style="color:#819aff"> :action</span><span style="color:#fd971f"> [</span><span style="color:#819aff">:the-bourne-identity</span><span style="color:#fd971f">]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; We can look up all movies by genre.</span></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#a6e22e">-&gt;&gt;</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">genre-&gt;movie</span><span style="color:#819aff"> :thriller</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#fd971f">     (</span><span style="color:#a6e22e">map</span><span style="color:#f8f8f2"> movies</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#fd971f">     (</span><span style="color:#a6e22e">sort-by</span><span style="color:#819aff"> :tomatometer</span><span style="color:#fd971f">))</span></span>
<span class="line"><span style="color:#88846f">; =&gt;</span></span>
<span class="line"><span style="color:#fd971f">({</span><span style="color:#819aff">:title</span><span style="color:#e6db74"> &quot;The Bourne Identity&quot;</span><span style="color:#f8f8f2">,</span></span>
<span class="line"><span style="color:#819aff">  :genres</span><span style="color:#fd971f"> [</span><span style="color:#819aff">:action</span><span style="color:#819aff"> :thriller</span><span style="color:#fd971f">]</span><span style="color:#f8f8f2">,</span></span>
<span class="line"><span style="color:#819aff">  :tomatometer</span><span style="color:#ae81ff"> 84</span><span style="color:#fd971f">}</span></span>
<span class="line"><span style="color:#fd971f"> {</span><span style="color:#819aff">:title</span><span style="color:#e6db74"> &quot;Nightcrawler&quot;</span><span style="color:#f8f8f2">,</span></span>
<span class="line"><span style="color:#819aff">  :genres</span><span style="color:#fd971f"> [</span><span style="color:#819aff">:drama</span><span style="color:#819aff"> :crime</span><span style="color:#819aff"> :thriller</span><span style="color:#fd971f">]</span><span style="color:#f8f8f2">,</span></span>
<span class="line"><span style="color:#819aff">  :tomatometer</span><span style="color:#ae81ff"> 95</span><span style="color:#fd971f">})</span></span>
<span class="line"></span></code></pre></div></div></div><div class="columns is-vcentered"><div class="column is-6"><h3 class="title">Convert bytes to human readable format</h3><p class="has-text-left"><p>Beyond the traditional <code>map</code>, <code>filter</code>, and <code>reduce</code>, jank provides a powerful <code>loop</code> macro for more imperative-style loops while still being purely functional. Each <code>loop</code> has one or more corresponding <code>recur</code> usages which must be in tail position.<p></div><div class="column is-8"><div class="content has-text-left"><pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">defn</span><span style="color:#f8f8f2"> size-&gt;human-readable</span></span>
<span class="line"><span style="color:#e6db74">  &quot;Converts a size, in bytes, to a human readable format, such as 0 B, 1.5 kB,</span></span>
<span class="line"><span style="color:#e6db74">   10 GB, etc.&quot;</span></span>
<span class="line"><span style="color:#fd971f">  [</span><span style="color:#f8f8f2">size-in-bytes</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#fb4934;font-weight:700">if</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">&lt;</span><span style="color:#ae81ff"> -1000</span><span style="color:#f8f8f2"> size-in-bytes </span><span style="color:#ae81ff">1000</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#fd971f">    (</span><span style="color:#a6e22e">str</span><span style="color:#f8f8f2"> size-in-bytes </span><span style="color:#e6db74">&quot; B&quot;</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#fd971f">    (</span><span style="color:#fb4934;font-weight:700">let</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">res </span><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">loop</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">acc size-in-bytes</span></span>
<span class="line"><span style="color:#f8f8f2">                     suffixes </span><span style="color:#e6db74">&quot;kMGTPE&quot;</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#fd971f">                (</span><span style="color:#fb4934;font-weight:700">if</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">&lt;</span><span style="color:#ae81ff"> -999950</span><span style="color:#f8f8f2"> acc </span><span style="color:#ae81ff">999950</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#fd971f">                  {</span><span style="color:#819aff">:size</span><span style="color:#f8f8f2"> acc</span></span>
<span class="line"><span style="color:#819aff">                   :suffix</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">first</span><span style="color:#f8f8f2"> suffixes</span><span style="color:#fd971f">)}</span></span>
<span class="line"><span style="color:#fd971f">                  (</span><span style="color:#fb4934;font-weight:700">recur</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">/</span><span style="color:#f8f8f2"> acc </span><span style="color:#ae81ff">1000</span><span style="color:#fd971f">)</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">drop</span><span style="color:#ae81ff"> 1</span><span style="color:#f8f8f2"> suffixes</span><span style="color:#fd971f">))))]</span></span>
<span class="line"><span style="color:#fd971f">      (</span><span style="color:#a6e22e">format</span><span style="color:#e6db74"> &quot;%.1f %cB&quot;</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">float</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">/</span><span style="color:#fd971f"> (</span><span style="color:#819aff">:size</span><span style="color:#f8f8f2"> res</span><span style="color:#fd971f">)</span><span style="color:#ae81ff"> 1000</span><span style="color:#fd971f">))</span><span style="color:#fd971f"> (</span><span style="color:#819aff">:suffix</span><span style="color:#f8f8f2"> res</span><span style="color:#fd971f">)))))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#a6e22e">assert</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">=</span><span style="color:#e6db74"> &quot;0 B&quot;</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">size-&gt;human-readable</span><span style="color:#ae81ff"> 0</span><span style="color:#fd971f">)))</span></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#a6e22e">assert</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">=</span><span style="color:#e6db74"> &quot;57.0 kB&quot;</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">size-&gt;human-readable</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">*</span><span style="color:#ae81ff"> 57</span><span style="color:#ae81ff"> 1000</span><span style="color:#fd971f">))))</span></span>
<span class="line"></span></code></pre></div></div></div><div class="columns is-vcentered"><div class="column is-6"><h3 class="title">Truncate a string to a max length</h3><p class="has-text-left"><p>jank's strings, as well as most of its other data structures, are immutable. However, jank provides such powerful tools for working with data that mutability is very rarely a concern.<p></div><div class="column is-8"><div class="content has-text-left"><pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">def</span><span style="color:#f8f8f2"> max-text-length </span><span style="color:#ae81ff">256</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">defn</span><span style="color:#f8f8f2"> truncate</span></span>
<span class="line"><span style="color:#e6db74">  &quot;Truncates the text to be no longer than the max length.&quot;</span></span>
<span class="line"><span style="color:#fd971f">  [</span><span style="color:#f8f8f2">text max-length</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#fb4934;font-weight:700">cond</span></span>
<span class="line"><span style="color:#fd971f">    (</span><span style="color:#a6e22e">&lt;=</span><span style="color:#f8f8f2"> max-length </span><span style="color:#ae81ff">0</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#e6db74">    &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#fd971f">    (</span><span style="color:#a6e22e">&lt;=</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">count</span><span style="color:#f8f8f2"> text</span><span style="color:#fd971f">)</span><span style="color:#f8f8f2"> max-length</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#f8f8f2">    text</span></span>
<span class="line"></span>
<span class="line"><span style="color:#819aff">    :else</span></span>
<span class="line"><span style="color:#fd971f">    (</span><span style="color:#a6e22e">str</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">subs</span><span style="color:#f8f8f2"> text </span><span style="color:#ae81ff">0</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">dec</span><span style="color:#f8f8f2"> max-length</span><span style="color:#fd971f">))</span><span style="color:#e6db74"> &quot;…&quot;</span><span style="color:#fd971f">)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#a6e22e">assert</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">=</span><span style="color:#e6db74"> &quot;&quot;</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">truncate</span><span style="color:#e6db74"> &quot;wowzer&quot;</span><span style="color:#ae81ff"> 0</span><span style="color:#fd971f">)))</span></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#a6e22e">assert</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">=</span><span style="color:#e6db74"> &quot;wow…&quot;</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">truncate</span><span style="color:#e6db74"> &quot;wowzer&quot;</span><span style="color:#ae81ff"> 4</span><span style="color:#fd971f">)))</span></span>
<span class="line"></span></code></pre></div></div></div><div class="columns is-vcentered"><div class="column is-6"><h3 class="title">Redefine any var</h3><p class="has-text-left"><p>Every <code>def</code> or <code>defn</code> exists within a var, which is a stable, namespace-level container for values. Vars can be redefined to contain different values. <code>with-redefs</code> redefines a var within its body's scope, which is very useful for removing side effects from test cases or forcing functions to return specific values.<p></div><div class="column is-8"><div class="content has-text-left"><pre class="shiki monokai"style="background-color:#272822;color:#f8f8f2"tabindex="0"><code><span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">defn</span><span style="color:#f8f8f2"> post! </span><span style="color:#fd971f">[</span><span style="color:#f8f8f2">_request</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#88846f">  ; Assuming this performs some network effect.</span></span>
<span class="line"><span style="color:#fd971f">  {</span><span style="color:#819aff">:status</span><span style="color:#ae81ff"> 200</span></span>
<span class="line"><span style="color:#819aff">   :body</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">pr-str</span><span style="color:#fd971f"> {</span><span style="color:#819aff">:order</span><span style="color:#ae81ff"> 7821</span><span style="color:#fd971f">})})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">defn</span><span style="color:#f8f8f2"> submit-order! </span><span style="color:#fd971f">[]</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#fb4934;font-weight:700">let</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">request </span><span style="color:#fd971f">{</span><span style="color:#819aff">:url</span><span style="color:#e6db74"> &quot;/submit-order&quot;</span><span style="color:#fd971f">}</span></span>
<span class="line"><span style="color:#f8f8f2">        order </span><span style="color:#fd971f">(</span><span style="color:#a6e22e">post!</span><span style="color:#f8f8f2"> request</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#f8f8f2">        order-body </span><span style="color:#fd971f">(</span><span style="color:#a6e22e">-&gt;</span><span style="color:#f8f8f2"> order </span><span style="color:#819aff">:body</span><span style="color:#f8f8f2"> read-string</span><span style="color:#fd971f">)]</span></span>
<span class="line"><span style="color:#fd971f">    (</span><span style="color:#fb4934;font-weight:700">if</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">contains?</span><span style="color:#f8f8f2"> order-body </span><span style="color:#819aff">:error</span><span style="color:#fd971f">)</span></span>
<span class="line"><span style="color:#88846f">      ; This is the code path we want to test.</span></span>
<span class="line"><span style="color:#fd971f">      {</span><span style="color:#819aff">:error</span><span style="color:#e6db74"> &quot;failed to submit&quot;</span></span>
<span class="line"><span style="color:#819aff">       :request</span><span style="color:#f8f8f2"> request</span></span>
<span class="line"><span style="color:#819aff">       :response</span><span style="color:#f8f8f2"> order-body</span><span style="color:#fd971f">}</span></span>
<span class="line"><span style="color:#fd971f">      (</span><span style="color:#819aff">:order</span><span style="color:#f8f8f2"> order-body</span><span style="color:#fd971f">))))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; Later on, in tests, skip the side effect by redefining.</span></span>
<span class="line"><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">deftest</span><span style="color:#f8f8f2"> submit-order</span></span>
<span class="line"><span style="color:#fd971f">  (</span><span style="color:#a6e22e">testing</span><span style="color:#e6db74"> &quot;failed post&quot;</span></span>
<span class="line"><span style="color:#fd971f">    (</span><span style="color:#a6e22e">with-redefs</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">post! </span><span style="color:#fd971f">(</span><span style="color:#fb4934;font-weight:700">fn</span><span style="color:#fd971f"> [</span><span style="color:#f8f8f2">_</span><span style="color:#fd971f">]</span></span>
<span class="line"><span style="color:#88846f">                          ; Fake error to see how the rest of the code handles it.</span></span>
<span class="line"><span style="color:#fd971f">                          {</span><span style="color:#819aff">:status</span><span style="color:#ae81ff"> 500</span></span>
<span class="line"><span style="color:#819aff">                           :body</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">pr-str</span><span style="color:#fd971f"> {</span><span style="color:#819aff">:error</span><span style="color:#e6db74"> &quot;uh oh&quot;</span><span style="color:#fd971f">})})]</span></span>
<span class="line"><span style="color:#fd971f">      (</span><span style="color:#a6e22e">is</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">=</span><span style="color:#e6db74"> &quot;failed to submit&quot;</span><span style="color:#fd971f"> (</span><span style="color:#819aff">:error</span><span style="color:#fd971f"> (</span><span style="color:#a6e22e">submit-order!</span><span style="color:#fd971f">)))))))</span></span>
<span class="line"></span></code></pre></div></div></div></div></section></div><footer class="footer"><div class="container"><div class="columns has-text-centered"></div><div class="container has-text-centered"><div class="content is-small"><p>© 2025 Jeaye Wilkerson | All rights reserved.</div></div></div></footer><noscript><p><img src="//matomo.jeaye.com/matomo.php?idsite=1&amp;rec=1"style="border:0"alt=""></p></noscript><script>for(var coll=document.getElementsByClassName("collapsible"),i=0;i<coll.length;i++)coll[i].addEventListener("click",function(){this.classList.toggle("active");var l=this.nextElementSibling;"block"===l.style.display?l.style.display="none":l.style.display="block"})</script>